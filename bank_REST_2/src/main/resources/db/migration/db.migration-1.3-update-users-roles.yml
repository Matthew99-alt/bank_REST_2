databaseChangeLog:
  - changeSet:
      id: 10
      author: matthew
      preConditions:
        - onFail: MARK_RAN
        - tableExists:
            tableName: role
        - not:
            tableExists:
              tableName: roles
      changes:
        - renameTable:
            oldTableName: role
            newTableName: roles
            remarks: "Переименование для соответствия сущности Role"

  - changeSet:
      id: 11
      author: matthew
      preConditions:
        - onFail: MARK_RAN
        - tableExists:
            tableName: roles
        - columnExists:
            tableName: roles
            columnName: name
      changes:
        - modifyDataType:
            tableName: roles
            columnName: name
            newDataType: varchar(20)
            remarks: "Для хранения значений Enum (ROLE_USER, ROLE_ADMIN)"

  - changeSet:
      id: 12
      author: matthew
      preConditions:
        - onFail: MARK_RAN
        - tableExists:
            tableName: user_roles
        - foreignKeyConstraintExists:
            foreignKeyName: fk_user_roles_role
      changes:
        - dropForeignKeyConstraint:
            baseTableName: user_roles
            constraintName: fk_user_roles_role

  - changeSet:
      id: 13
      author: matthew
      preConditions:
        - onFail: MARK_RAN
        - tableExists:
            tableName: user_roles
        - tableExists:
            tableName: roles
        - not:
            foreignKeyConstraintExists:
              foreignKeyName: fk_user_roles_role
      changes:
        - addForeignKeyConstraint:
            baseTableName: user_roles
            baseColumnNames: role_id
            referencedTableName: roles
            referencedColumnNames: id
            constraintName: fk_user_roles_role
            deferrable: false
            initiallyDeferred: false

  - changeSet:
      id: 14
      author: matthew
      preConditions:
        - onFail: MARK_RAN
        - not:
            sequenceExists:
              sequenceName: roles_seq
      changes:
        - createSequence:
            sequenceName: roles_seq
            startValue: 1
            incrementBy: 1